# Live Response en Windows: Comandos Esenciales

Esta guía contiene comandos útiles para realizar una investigación inicial (Live Response) en un sistema Windows vivo. Ejecútalos con precaución y preferiblemente redirigiendo la salida a un medio externo seguro.

| Tarea/Objetivo                      | Comando (CMD / PowerShell)                                                              | Notas / Qué Buscar                                                                                                                               |
| :---------------------------------- | :-------------------------------------------------------------------------------------- | :----------------------------------------------------------------------------------------------------------------------------------------------- |
| **Información del Sistema** | `systeminfo`                                                                            | Versión OS, Parches (Hotfixes), Tiempo de actividad, Arquitectura. Útil para perfil Volatility.                                                   |
|                                     | `hostname`                                                                              | Nombre del host.                                                                                                                                 |
|                                     | `date /t && time /t` (CMD)                                                              | Fecha y hora actuales del sistema (correlacionar con logs).                                                                                     |
|                                     | `Get-ComputerInfo` (PS)                                                                 | Alternativa PowerShell a `systeminfo`.                                                                                                            |
|                                     | `Get-Hotfix` (PS)                                                                       | Lista parches instalados.                                                                                                                        |
| **Procesos en Ejecución** | `tasklist`                                                                              | Lista procesos, PID, uso memoria.                                                                                                               |
|                                     | `tasklist /svc`                                                                         | Muestra servicios alojados en cada proceso (`svchost.exe`).                                                                                      |
|                                     | `tasklist /m`                                                                           | Muestra DLLs cargadas por cada proceso.                                                                                                         |
|                                     | `tasklist /fi "PID eq <PID>"`                                                             | Filtra detalles de un PID específico. Reemplaza `<PID>`.                                                                                         |
|                                     | `wmic process list brief`                                                               | Otra forma de listar procesos vía WMIC.                                                                                                         |
|                                     | `wmic process get name, processid, parentprocessid, commandline /format:csv`            | **Muy útil:** Nombre, PID, PID Padre, ¡Línea de Comandos! (requiere auditoría a veces). Buscar comandos/parámetros extraños.                       |
|                                     | `Get-Process` (PS)                                                                      | Equivalente PowerShell a `tasklist`.                                                                                                           |
|                                     | `Get-CimInstance -ClassName Win32_Process \| Select Name, ProcessId, ParentProcessId, CommandLine` (PS) | Equivalente PowerShell a `wmic process get...`.                                                                                              |
| **Conexiones de Red** | `netstat -ano`                                                                          | **Fundamental:** Conexiones TCP/UDP (activas/escucha), IPs/Puertos (loc/rem), Estado, PID asociado (`-o`). `-n` evita DNS. `-a` todo. Buscar conexiones a IPs/puertos C2, puertos escucha inesperados. |
|                                     | `netstat -an \| findstr "ESTABLISHED"` (CMD)                                            | Muestra solo conexiones TCP establecidas.                                                                                                       |
|                                     | `Get-NetTCPConnection` (PS)                                                             | Equivalente PowerShell a `netstat` para TCP.                                                                                                    |
|                                     | `Get-NetUDPEndpoint` (PS)                                                               | Equivalente PowerShell para UDP (puertos escucha).                                                                                             |
| **Usuarios Logueados** | `query user`                                                                            | Muestra usuarios con sesión activa (local/RDP).                                                                                                 |
|                                     | `whoami /all`                                                                           | Info del usuario actual, grupos, privilegios (SID).                                                                                             |
|                                     | `net user`                                                                              | Lista cuentas de usuario locales. Buscar cuentas desconocidas/sospechosas.                                                                       |
|                                     | `net localgroup administrators`                                                         | Lista miembros del grupo Admins locales. ¿Hay usuarios inesperados?                                                                               |
|                                     | `Get-LocalUser` (PS)                                                                    | Equivalente PS a `net user`.                                                                                                                    |
|                                     | `Get-LocalGroupMember Administrators` (PS)                                              | Equivalente PS a `net localgroup administrators`.                                                                                              |
| **Tareas Programadas** | `schtasks /query /fo LIST /v`                                                         | Lista tareas programadas con detalles. Buscar tareas creadas por malware para persistencia (ejecutables/scripts sospechosos).                       |
|                                     | `Get-ScheduledTask` (PS)                                                                | Equivalente PowerShell.                                                                                                                         |
| **Servicios** | `sc query state= all`                                                                 | Lista todos los servicios y su estado. Buscar servicios desconocidos o con nombres/rutas sospechosas.                                          |
|                                     | `net start`                                                                             | Muestra servicios en ejecución.                                                                                                                 |
|                                     | `Get-Service` (PS)                                                                      | Equivalente PowerShell.                                                                                                                         |
| **Recursos Compartidos** | `net share`                                                                             | Muestra recursos compartidos locales. ¿Hay shares inesperados (ej. C$ activado)?                                                               |
|                                     | `net use`                                                                               | Muestra conexiones salientes a recursos compartidos remotos.                                                                                   |
|                                     | `Get-SmbShare` (PS)                                                                     | Equivalente PS a `net share`.                                                                                                                   |
|                                     | `Get-SmbConnection` (PS)                                                                | Muestra conexiones SMB salientes activas.                                                                                                       |
| **Otros (Configuración/Caché)** | `arp -a`                                                                                | Muestra caché ARP (IP -> MAC local).                                                                                                             |
|                                     | `ipconfig /all`                                                                         | Configuración IP completa (IP, GW, DNS, MAC...).                                                                                              |
|                                     | `ipconfig /displaydns`                                                                  | Muestra caché de resolución DNS del cliente. Buscar dominios sospechosos resueltos recientemente.                                               |
|                                     | `route print`                                                                           | Tabla de rutas IP. Buscar rutas estáticas sospechosas.                                                                                        |
|                                     | `driverquery /v`                                                                        | Lista drivers cargados. Buscar drivers no firmados o sospechosos.                                                                                |

## 🛠️ Mención Especial: Sysinternals Suite

La suite **Sysinternals** de Microsoft (creada por Mark Russinovich) contiene herramientas **externas** increíblemente útiles para Live Response (y análisis general). Deben descargarse desde el sitio oficial de Microsoft y ejecutarse desde un medio confiable. Algunas clave:

* **`Autoruns`**: Muestra **TODAS** las ubicaciones de auto-inicio (persistencia): Run keys, Servicios, Tareas Programadas, DLLs cargadas, Drivers, etc. Imprescindible para buscar persistencia.
* **`Process Explorer`**: Un "Administrador de Tareas" avanzado. Muestra procesos en árbol, DLLs cargadas, handles abiertos, permite verificar firmas, buscar procesos por handle/DLL, etc.
* **`Process Monitor`**: Monitoriza en tiempo real la actividad del sistema de archivos, registro y red a nivel de proceso. Puede generar mucho ruido, pero es potente para ver qué hace exactamente un proceso.
* **`TCPView`**: GUI similar a `netstat` pero con más detalles y refresco en tiempo real de las conexiones de red.
* **`Strings`**: Extrae cadenas de texto de archivos binarios (como se vio en Forense de Disco).

---
*La clave del Live Response es ser rápido, metódico, documentar todo y recopilar la información más volátil primero, minimizando la alteración del sistema.*
